#!/usr/bin/perl
use strict;
use warnings;
use CSS::Minifier qw(minify);
use File::Copy;
use Cwd;

my $orig_css_path='';
my @css_files=("core","pagelayout","ezflow","content");
my $dest_path="/var/www/com/extension/mondelli/design/mondelli/stylesheets/";
my @source_css=();
my %files_to_process=();

foreach my $css_file (@css_files){
    $orig_css_path=$dest_path.$css_file;
    print "$orig_css_path\n";
    @source_css=`find $orig_css_path -iname '*.css'`;
    chomp(@source_css);
    $files_to_process{$css_file}=[@source_css];
    print "@{ $files_to_process{$css_file} }\n";
}
foreach my $dest_file (@css_files) {
    print "$dest_file\n";

    open(CONTENT ,"+>$dest_path$dest_file.cssclear") or die "Can't create file";
    print CONTENT "/*DO NOT EDIT THIS FILE IS AUTOMATICALLY GENERATED*/\n";
    foreach my $file (@{ $files_to_process{$dest_file} }){
        print "$file\n";
        open PART, $file or die "Can't open $file";
        print CONTENT "/* $file */\n";
        print CONTENT while (<PART>);
        close PART;
    }
    close CONTENT;
    open(CONTENT ,"$dest_path$dest_file.cssclear") or die "Can't create file";
    open(MINCONTENT ,">$dest_path$dest_file.css") or die "Can't create file";
    minify(input => *CONTENT, outfile => *MINCONTENT);
    close MINCONTENT;
    close CONTENT;
    unlink("$dest_path$dest_file.cssclear");
    print "$dest_path$dest_file.css\n";
}


